
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../css/dashboard-funcionario.css">
        <!-- scripts do Chart.js - 2022-1 -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <title>Document</title>
    </head>
    <body>
        <header>
            <div class="div-header">
                <a href="../login.html">
                    NOCT.U
                    <img src="../assets/icon/favicon2.svg" alt="">
                </a>
            </div>
            <div class="div-header">
                <label class="txt-header" for="">SPTECH</label>
            </div>
            <div class="div-header">
                <label class="txt-header" for="">CARAMICO</label>
            </div>
        </header>
        <div class="div-dash">
            <div class="div-alertas">
                <div class="div-alertas2">
                    <div class="alertas">
                        <div class="div-title-alertas">
                            <h2>HISTÓRICO DE ALERTAS</h2>
                        </div>
                        <div class="div-notificao">
                            <div class="div-caixa-mensagem">
                                <div class="caixa-mensagem perigo">
                                    <p>CPU - Ocupação acima do limite</p>
                                </div>
                            </div>

                            <div class="div-caixa-mensagem">
                                <div class="caixa-mensagem cuidado">
                                    <p>CPU - Ocupação proxima do limite</p>
                                </div>
                            </div>

                            <div class="div-caixa-mensagem">
                                <div class="caixa-mensagem cuidado">
                                    <p>Memoria - Memória proxima do limite</p>
                                </div>
                            </div>

                            <div class="div-caixa-mensagem">
                                <div class="caixa-mensagem perigo">
                                    <p>CPU - Ocupação acima do limite</p>
                                </div>
                            </div>

                            <div class="div-caixa-mensagem">
                                <div class="caixa-mensagem perigo">
                                    <p>CPU - Ocupação acima do limite</p>
                                </div>
                            </div>

                            <div class="div-caixa-mensagem">
                                <div class="caixa-mensagem cuidado">
                                    <p>Memoria - Memória proxima do limite</p>
                                </div>
                            </div>

                            <div class="div-caixa-mensagem">
                                <div class="caixa-mensagem cuidado">
                                    <p>CPU - Ocupação proxima do limite</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button>Lista de Computadores</button>
                </div>
            </div>
            <div class="div-conteudo">
                <div class="div-kpis">
                    <div class="kpis">
                        <div class="sessao-title-kpi">
                            <div class="rotulo-kpi">
                                <label for="">Informações da máquina</label>
                            </div>
                        </div>
                        <div class="sessao-subtitle-kpi">
                            <label for="">Número de série:</label>
                        </div>
                        <div class="sessao-subtitle-kpi div-num-serie">
                            <label for="" class="num-serie" id="num_serie"></label>
                        </div>
                        <div class="div-linha-kpi">
                            <div class="linha-kpi"></div>
                        </div>
                        <div class="sessao-subtitle-kpi">
                            <label for="">Modelo:</label>
                        </div>
                        <div class="sessao-subtitle-kpi div-num-serie">
                            <label for="" class="num-serie" id="modelo_nome">IdealPad</label>
                        </div>
                    </div>
                    <div class="kpis">
                        <div class="sessao-title-kpi">
                            <div class="rotulo-kpi2">
                                <label for="">Tempo de atividade da máquina</label>
                            </div>
                        </div>
                        <div class="sessao-subtitle-kpi div-num-serie">
                            <label for="" class="num-serie">04:20:15:53</label>
                        </div>  
                        <div class="sessao-subtitle-kpi">
                            <label for="">Janelas:</label>
                        </div>
                        <div class="sessao-subtitle-kpi div-num-serie">
                            <label for="" class="janelas">05</label>
                        </div>
                    </div>
                    <div class="kpis">
                        <div class="sessao-title-kpi sessao-title-kpi2">
                            <div class="rotulo-kpi3">
                                <label for="">Disco - Utilização</label>
                            </div>
                        </div>
                        <div class="div-grafico">
                            <div class="div-legenda">
                                <div class="legenda">
                                    <div class="cor-grafico cor-grafico1"></div><p>EM USO</p>
                                </div>
                                <div class="legenda">
                                    <div class="cor-grafico cor-grafico2"></div><p>DISPONÍVEL</p>
                                </div>
                            </div>
                            <div class="div-grafico1">
                                <canvas id="myChartCanvasGeral"></canvas>
                            </div>
                            <div class="legenda-total">
                                <p>Total:</p>
                            </div>
                            
                        </div>
                    </div>
                    <div class="kpis">
                        <div class="sessao-title-kpi4">
                            <div class="rotulo-kpi4">
                                <label for="">Estado atual do componente</label>
                            </div>
                        </div>
                        <div class="div-conteudo-kpi4">
                            <div class="componentes-kpi">
                                <p>CPU</p><div class="cor-grafico cor-graficocomp cor1"></div>
                            </div>
                            <div class="componentes-kpi">
                                <p>MEMÓRIA</p><div class="cor-grafico cor-graficocomp cor2"></div>
                            </div>
                            <div class="componentes-kpi">
                                <p>DISCO</p><div class="cor-grafico cor-graficocomp cor3"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="div-graficos">
                    <div class="div-grafico-linha">
                        <h2>CPU - DESEMPENHO</h2>
                        <div class="grafico-linha">
                            <canvas id="myChartCanvasGeral2"></canvas>
                        </div>
                    </div>
                    <div class="div-grafico-pizza">
                        <div class="sessao-title-kpi sessao-title-kpi2">
                            <div class="rotulo-kpi3 rotulo-grafico3">
                                <label for="">Memória - Utilização</label>
                            </div>
                        </div>
                        <div class="div-grafico">
                            <div class="div-legenda div-legenda3">
                                <div class="legenda legenda-grafico3">
                                    <div class="cor-grafico cor-grafico1 cor-grafico3"></div><p>EM USO</p>
                                </div>
                                <div class="legenda  legenda-grafico3">
                                    <div class="cor-grafico cor-grafico2 cor-grafico3"></div><p>DISPONÍVEL</p>
                                </div>
                            </div>
                            <div class="div-grafico3">

                                <canvas id="myChartCanvasGeral3"></canvas>
                            </div>
                            <div class="legenda-total legenda-total3">
                                <p>Total:</p>
                            </div>
                        </div> 

                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
<script>
    num_serie.innerHTML = sessionStorage.ID_COMPUTADOR;
    modelo_nome.innerHTML = sessionStorage.MODELO_COMPUTADOR;

    obterDadosGrafico(sessionStorage.ID_COMPUTADOR);
    obterDadosGraficoRam(sessionStorage.ID_COMPUTADOR)
    obterDadosGraficoCpu(sessionStorage.ID_COMPUTADOR)
   
    function obterDadosGrafico(idComputador) {
    

        //GRAFICO DISCO

        fetch("/computadores/consultarDados", {
              method: "POST",
              headers: {
                  "Content-Type": "application/json"
              },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    //Dados da primeira pag de cadastro
                    idComputadorServer : idComputador,
                    idHardwareServer : 3
                })
          }).then(function (ultimaCaptura) {
              console.log("ESTOU NO THEN DO NOVA FUnCTIONS()!")
  
              if (ultimaCaptura.ok) {

                  ultimaCaptura.json().then(ultimaCaptura => {
                    // var campeao = jsonMelhoresQuiz[0].nome;
                    // var menorPontuacao = jsonMelhoresQuiz[jsonMelhoresQuiz.length - 1].nome;
                    // info1.innerHTML = "Líder : "+ campeao;
                    // info2.innerHTML = "Menor desempenho do ranking no torneio: "+menorPontuacao;
                    console.log(ultimaCaptura);

                    var capacidade = ultimaCaptura[0].capacidade;
                    var uso = ultimaCaptura[0].valor;

                    console.log(capacidade,uso)
                    plotarGrafico(capacidade,uso);
                  });
  
              } else {

  
                  ultimaCaptura.text().then(texto => {
                      console.error(texto);
                      // finalizarAguardar(texto);
                  });
              }
  
          })
          .catch(function (erro) {
              console.log(erro);
          })


         

          
    }


    function obterDadosGraficoRam(idComputador){
         //GRAFICO RAM

         fetch("/computadores/consultarDados", {
              method: "POST",
              headers: {
                  "Content-Type": "application/json"
              },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    //Dados da primeira pag de cadastro
                    idComputadorServer : sessionStorage.ID_COMPUTADOR,
                    idHardwareServer : 2
                })
          }).then(function (ultimaCaptura) {
              console.log("ESTOU NO THEN DO NOVA FUnCTIONS()!")
  
              if (ultimaCaptura.ok) {

                  ultimaCaptura.json().then(ultimaCaptura => {
                    // var campeao = jsonMelhoresQuiz[0].nome;
                    // var menorPontuacao = jsonMelhoresQuiz[jsonMelhoresQuiz.length - 1].nome;
                    // info1.innerHTML = "Líder : "+ campeao;
                    // info2.innerHTML = "Menor desempenho do ranking no torneio: "+menorPontuacao;
                    console.log(ultimaCaptura);

                    var capacidade = ultimaCaptura[0].capacidade;
                    var uso = ultimaCaptura[0].valor;
                    
                    
                    plotarGraficoRam(capacidade,uso)
                  });
  
              } else {

  
                  ultimaCaptura.text().then(texto => {
                      console.error(texto);
                      // finalizarAguardar(texto);
                  });
              }
  
          })
          .catch(function (erro) {
              console.log(erro);
          })

    } 

    //Plotar grafico Disco
    function plotarGrafico(capacidade,uso) {

        var disponivel = capacidade - uso;

        var dados = {
            labels: ['GBS EM USO', 'GBS DISPONÍVEIS'],
            datasets: [
                {
                    label: [],
                    data: [],
                    backgroundColor: ['rgb(96, 116, 188)','rgb(9, 19, 56)'],
                    borderWidth: 1,
                }

            ]
        };
                  
        dados.datasets[0].data.push(uso);
        dados.datasets[0].data.push(disponivel);
       
            const config = {
                type: 'pie',
                data: dados,
                options: {
                    plugins: {
                    legend: {
                        display: false
                       
                    },
                    },
                },
                };

            // Adicionando gráfico criado em div na tela
            let myChart = new Chart(
                document.getElementById(`myChartCanvasGeral`),
                config
            );

        // setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
    }


    //Plotar Grafico Ram
    function plotarGraficoRam(capacidade,uso) {           

            var dados3 = {
            labels: ['% EM USO', '% DISPONÍVEIS'],
            datasets: [
                {
                    label: [],
                    data: [],
                    backgroundColor: ['rgb(96, 116, 188)','rgb(9, 19, 56)'],
                    borderWidth: 1,
                }

            ]
            };

            //convertendo em porcentagem
            uso = parseInt((uso / capacidade) * 100);
            var disponivel = parseInt(100 - uso);

            dados3.datasets[0].data.push(uso);
            dados3.datasets[0].data.push(disponivel);
            const config3 = {
                type: 'pie',
                data: dados3,
                options: {
                    plugins: {
                    legend: {
                        display: false
                       
                    },
                    },
                },
                };

            // Adicionando gráfico criado em div na tela
            let myChart3 = new Chart(
                document.getElementById(`myChartCanvasGeral3`),
                config3
            );

        // setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
        }




        function obterDadosGraficoCpu(idComputador){
         //GRAFICO RAM

         fetch("/computadores/consultarDadosCPU", {
              method: "POST",
              headers: {
                  "Content-Type": "application/json"
              },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    //Dados da primeira pag de cadastro
                    idComputadorServer : sessionStorage.ID_COMPUTADOR,
                    idHardwareServer : 1
                })
          }).then(function (ultimaCaptura) {
              console.log("ESTOU NO THEN DO NOVA FUnCTIONS()!")
  
              if (ultimaCaptura.ok) {

                  ultimaCaptura.json().then(ultimaCaptura => {
                    console.log(ultimaCaptura);

                    
                    
                    
                    plotarGraficoCpu(ultimaCaptura)
                  });
  
              } else {

  
                  ultimaCaptura.text().then(texto => {
                      console.error(texto);
                      // finalizarAguardar(texto);
                  });
              }
  
          })
          .catch(function (erro) {
              console.log(erro);
          })

    } 
    
    function plotarGraficoCpu(ultimaCaptura) {           

        var dados2 = {
            labels: [],
            datasets: [
                {
                label: 'DESEMPENHO',
                data: [],
                backgroundColor: ['rgb(96, 116, 188)'],
                borderWidth: 1,
                borderColor: '#4F64B0'
                }

        ]
        };

        for(var i = (ultimaCaptura.length - 1); i >= 0; i-- ){
            
            const dataObj = new Date(ultimaCaptura[i].dtCaptura);
            var minutosCaptura = dataObj.getMinutes()
            var segundosCaptura = dataObj.getSeconds()


            const dataAtual = new Date();
            var minutosAtual = dataAtual.getMinutes();
            var segundosAtual = dataAtual.getSeconds();


            var minutos = 60 * (minutosAtual - minutosCaptura);
            var segundos = minutos + (segundosAtual - segundosCaptura);



            dados2.labels.push("Há " + segundos + " segs");
            dados2.datasets[0].data.push(ultimaCaptura[i].valor);

        }
            const config2 = {
                type: 'line',
                data: dados2,
                options: {
                    plugins: {
                    legend: {
                        display: false
                    },

                    },
                },
                };

            // Adicionando gráfico criado em div na tela
            let myChart2 = new Chart(
                document.getElementById(`myChartCanvasGeral2`),
                config2
            );

        // setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
        }



</script>

